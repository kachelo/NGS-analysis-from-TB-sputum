#!/bin/bash
#set -x

# Test known sequences for READGROUPS

FILENAMES=(
	# SAMPLE_LIBRARY_TREATMENT_PLATFORM_CENTER_L00[0-8]_R[12].fastq.gz
	#	/labs/lf/tb/data/fastq/rename/28_L004_R1_001.fastq.gz
	'28_20150728_default_ILLUMINA_USEC-INMEGEN_L004_R1_001.fastq.gz'
	#	/labs/lf/tb/data/fastq/rename/28N_L001_R2_001.fastq.gz
	'28_20150728_reseq_ILLUMINA_USEC-INMEGEN_L001_R2_001.fastq.gz'
	#	/labs/lf/tb/data/fastq/rename/28D_L001_R1_001.fastq.gz
	'28_20150216_test_ILLUMINA_unknown_L001_R1_001.fastq.gz'
	#	./MT70-TSO28-33403463/g143-1-40901639/g143-1_S1_L001_R2_001.fastq.gz
	'g143-1-S1_MT70-TSO28_default_ILLUMINA_LDG-INMEGEN_L001_R2_001.fastq.gz'
	#	./MT6-EXOMA-NextSeqIBt-CorridadeMalaCalidad/CA6-1-23212194/CA6-1_S3_L002_R2_001.fastq.gz
	'CA6-1-S3_MT6-exoma_transport_ILLUMINA_IBT-UNAM_L002_R2_001.fastq.gz'
	#	./MT142-CA43-50636587/CA360-1-60689710/CA360-1_S12_L002_R1_001.fastq.gz
	'CA360-1-S12_MT142-CA43_default_ILLUMINA_USEC-INMEGEN_L002_R1_001.fastq.gz'
)

FQ_READS=(
	# SEQUENCER:RUN:FLOWCEL:LANE:TILE:x:y
	'@NS500560:8:H3KJNAFXX:4:11401:10238:1053 1:N:0:GCTAACGA'
	'@NS500560:112:HFG7TAFXX:1:11101:19053:1190 2:N:0:GCTAACGA'
	'@M01459:11:000000000-ABT22:1:1101:15757:1371 1:N:0:8'
	'@M04474:45:000000000-AL055:1:1101:27646:7655 2:N:0:TAAGGCGA+TATCCTCT'
	'@NS500502:9:H2Y5HAFXX:2:11101:21793:1038 2:N:0:3'
	'@NS500560:115:HNWWJAFXX:2:11101:22595:1169 1:N:0:GGACTCCT+NACTCCTT'
)


READ_GROUPS=(
	# ID, SM (sample), LB (library), PU (Platform unit), PL (Platform), CN (Sequencing Center)
	'ID:28.20150728.default\tPU:H3KJNAFXX.4\tSM:28\tLB:20150728\tPL:ILLUMINA\tCN:USEC-INMEGEN'
	'ID:28.20150728.reseq\tPU:HFG7TAFXX.1\tSM:28\tLB:20150728\tPL:ILLUMINA\tCN:USEC-INMEGEN'
	'ID:28.20150216.test\tPU:000000000-ABT22.1\tSM:28\tLB:20150216\tPL:ILLUMINA\tCN:unknown'
	'ID:g143-1-S1.MT70-TSO28.default\tPU:000000000-AL055.1\tSM:g143-1-S1\tLB:MT70-TSO28\tPL:ILLUMINA\tCN:LDG-INMEGEN'
	'ID:CA6-1-S3.MT6-exoma.transport\tPU:H2Y5HAFXX.2\tSM:CA6-1-S3\tLB:MT6-exoma\tPL:ILLUMINA\tCN:IBT-UNAM'
	'ID:CA360-1-S12.MT142-CA43.default\tPU:HNWWJAFXX.2\tSM:CA360-1-S12\tLB:MT142-CA43\tPL:ILLUMINA\tCN:USEC-INMEGEN'
)

test_valid() {
        rv=0
        for i in `seq 0 $(( ${#FQ_READS[@]} - 1 ))`; do
                RG=`echo ${FQ_READS[$i]} | bin/assign-read-groups -v "FILENAME=${FILENAMES[$i]}"`
                [ "$RG" == "${READ_GROUPS[$i]}" ] || {
			echo "\"${RG}\" is not \"${READ_GROUPS[$i]}\""
                        rv=1
                }
        done
	exit "$rv"
}

test_valid
